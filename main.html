<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https://cdn-icons-png.flaticon.com/128/6878/6878693.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://cdn-icons-png.flaticon.com/128/6878/6878693.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://cdn-icons-png.flaticon.com/128/6878/6878693.png"
    />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#e50914" />
    <meta name="msapplication-TileColor" content="#221f1f" />
    <meta name="theme-color" content="#221f1f" />

    <!-- Primary Meta Tags -->
    <title>MovieHatch - Premium Movie Streaming & Download Platform</title>
    <meta
      name="description"
      content="Stream unlimited movies and TV shows in HD quality. Download your favorites to watch offline. Join MovieHatch for the best streaming experience with no ads."
    />
    <meta
      name="keywords"
      content="stream movies, watch TV shows, movie downloads, premium streaming, HD movies, no ads streaming, online cinema"
    />
    <meta name="author" content="MovieHatch" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph / Facebook Meta Tags -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://moviehatch.onrender.com/" />
    <meta
      property="og:title"
      content="MovieHatch - Premium Movie Streaming & Download Platform"
    />
    <meta
      property="og:description"
      content="Stream unlimited movies and TV shows in HD quality. Download your favorites to watch offline with MovieHatch."
    />
    <meta
      property="og:image"
      content="https://cdn-icons-png.flaticon.com/128/6878/6878693.png"
    />

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://moviehatch.onrender.com/" />
    <meta
      name="twitter:title"
      content="MovieHatch - Premium Movie Streaming & Download Platform"
    />
    <meta
      name="twitter:description"
      content="Stream unlimited movies and TV shows in HD quality. Download your favorites to watch offline with MovieHatch."
    />
    <meta
      name="twitter:image"
      content="https://cdn-icons-png.flaticon.com/128/6878/6878693.png"
    />

    <!-- Structured Data / Schema Markup -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "MovieHatch",
        "url": "https://moviehatch.onrender.com",
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://moviehatch.onrender.com/search?q={search_term_string}",
          "query-input": "required name=search_term_string"
        }
      }
    </script>

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "MovieHatch",
        "url": "https://moviehatch.onrender.com",
        "logo": "https://cdn-icons-png.flaticon.com/128/6878/6878693.png",
        "sameAs": [
          "https://moviehatch.onrender.com",
          "https://moviehatch.onrender.com",
          "https://moviehatch.onrender.com"
        ]
      }
    </script>

    <!-- Canonical URL -->
    <link rel="canonical" href="https://moviehatch.onrender.com" />

    <title>Dashboard - MovieHatch</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <style>
      :root {
        --primary: #e50914;
        --primary-dark: #b2070f;
        --secondary: #1a1a1a;
        --dark: #0f0f0f;
        --light: #ffffff;
        --gray: #333333;
        --gray-light: #666666;
        --gold: #ffd700;
        --green: #00d4aa;
        --transition: all 0.3s ease;
        --gradient: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        --sidebar-width: 250px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Montserrat", sans-serif;
        background: var(--dark);
        color: var(--light);
        overflow-x: hidden;
        line-height: 1.6;
        min-height: 100vh;
      }

      /* Preloader */
      .preloader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--dark);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease;
      }

      .preloader.fade-out {
        opacity: 0;
      }

      .loader {
        width: 60px;
        height: 60px;
        border: 6px solid var(--gray);
        border-top: 6px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Layout */
      .app-container {
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: var(--sidebar-width);
        background: var(--secondary);
        padding: 20px 0;
        position: fixed;
        height: 100vh;
        left: 0;
        top: 0;
        z-index: 1000;
        border-right: 1px solid var(--gray);
        transition: transform 0.3s ease;
      }

      .sidebar.hidden {
        transform: translateX(-100%);
      }

      .logo {
        padding: 0 20px 30px;
        border-bottom: 1px solid var(--gray);
        margin-bottom: 20px;
      }

      .logo h1 {
        font-family: "Playfair Display", serif;
        font-size: 1.8rem;
        color: var(--primary);
        font-weight: 700;
      }

      .nav-menu {
        list-style: none;
        padding: 0;
      }

      .nav-item {
        margin-bottom: 5px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        color: var(--light);
        text-decoration: none;
        transition: var(--transition);
        border-left: 3px solid transparent;
      }

      .nav-link:hover,
      .nav-link.active {
        background: rgba(229, 9, 20, 0.1);
        border-left-color: var(--primary);
        color: var(--primary);
      }

      .nav-link i {
        margin-right: 12px;
        width: 20px;
        text-align: center;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        transition: margin-left 0.3s ease;
      }

      .main-content.expanded {
        margin-left: 0;
      }

      /* Header */
      .header {
        background: var(--secondary);
        padding: 15px 30px;
        border-bottom: 1px solid var(--gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 999;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .menu-toggle {
        background: none;
        border: none;
        color: var(--light);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 4px;
        transition: var(--transition);
      }

      .menu-toggle:hover {
        background: var(--gray);
      }

      .search-container {
        position: relative;
        width: 400px;
      }

      .search-input {
        width: 100%;
        padding: 12px 20px 12px 45px;
        background: var(--gray);
        border: 2px solid transparent;
        border-radius: 25px;
        color: var(--light);
        font-size: 0.95rem;
        transition: var(--transition);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary);
        background: var(--dark);
      }

      .search-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-light);
      }

      .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--secondary);
        border-radius: 10px;
        margin-top: 5px;
        max-height: 300px;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
      }

      .search-result-item {
        padding: 12px 20px;
        cursor: pointer;
        transition: var(--transition);
        border-bottom: 1px solid var(--gray);
      }

      .search-result-item:hover {
        background: var(--gray);
      }

      .search-result-item:last-child {
        border-bottom: none;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .balance-display {
        background: var(--gradient);
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .balance-display:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(229, 9, 20, 0.3);
      }

      .header-btn {
        background: var(--gray);
        border: none;
        color: var(--light);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header-btn:hover {
        background: var(--primary);
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 20px;
        transition: var(--transition);
      }

      .user-profile:hover {
        background: var(--gray);
      }

      .user-avatar {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: var(--gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.9rem;
      }

      /* Content Area */
      .content {
        padding: 30px;
      }

      /* Section Styles */
      .section {
        margin-bottom: 40px;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .section-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--light);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-title i {
        color: var(--primary);
      }

      .view-more {
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
        transition: var(--transition);
      }

      .view-more:hover {
        color: var(--primary-dark);
      }

      /* Movie Grid */
      .movies-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
      }

      .movie-card {
        background: var(--secondary);
        border-radius: 12px;
        overflow: hidden;
        transition: var(--transition);
        cursor: pointer;
        position: relative;
        border: 1px solid transparent;
      }

      .movie-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
        border-color: var(--primary);
      }

      .movie-poster {
        width: 100%;
        height: 280px;
        background: linear-gradient(45deg, var(--primary), var(--gold));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: white;
        position: relative;
        overflow: hidden;
      }

      .movie-poster img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .movie-rating {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: var(--gold);
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 700;
      }

      .play-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: var(--transition);
      }

      .movie-card:hover .play-overlay {
        opacity: 1;
      }

      .play-btn {
        background: var(--primary);
        border: none;
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        transition: var(--transition);
      }

      .play-btn:hover {
        transform: scale(1.1);
      }

      .movie-info {
        padding: 15px;
      }

      .movie-title {
        font-size: 1rem;
        font-weight: 700;
        margin-bottom: 8px;
        color: var(--light);
        line-height: 1.3;
      }

      .movie-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        font-size: 0.8rem;
        color: var(--gray-light);
      }

      .movie-genre {
        background: rgba(229, 9, 20, 0.2);
        color: var(--primary);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
      }

      .movie-description {
        color: var(--gray-light);
        font-size: 0.85rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* Upload Section */
      .upload-section {
        background: var(--secondary);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        border: 1px solid var(--gray);
      }

      .upload-form {
        display: grid;
        gap: 20px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .form-group {
        position: relative;
      }

      .form-group.full-width {
        grid-column: 1 / -1;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--light);
        font-size: 0.9rem;
      }

      .form-input,
      .form-textarea,
      .form-select {
        width: 100%;
        padding: 12px 16px;
        background: var(--gray);
        border: 2px solid transparent;
        border-radius: 8px;
        color: var(--light);
        font-size: 0.95rem;
        transition: var(--transition);
        font-family: inherit;
      }

      .form-input:focus,
      .form-textarea:focus,
      .form-select:focus {
        outline: none;
        border-color: var(--primary);
        background: var(--dark);
      }

      .form-textarea {
        resize: vertical;
        min-height: 100px;
      }

      .upload-btn {
        background: var(--gradient);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 700;
        font-size: 1rem;
        width: 100%;
      }

      .upload-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(229, 9, 20, 0.3);
      }

      /* Movie Player Modal */
      .movie-player-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 10000;
        backdrop-filter: blur(10px);
      }

      .movie-player-modal.active {
        display: block;
      }

      .player-container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .player-header {
        background: rgba(0, 0, 0, 0.8);
        padding: 20px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--gray);
      }

      .player-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--light);
      }

      .close-player {
        background: var(--primary);
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        transition: var(--transition);
      }

      .close-player:hover {
        background: var(--primary-dark);
        transform: scale(1.1);
      }

      .player-content {
        flex: 1;
        display: flex;
        position: relative;
      }

      .video-section {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
      }

      .video-player {
        width: 100%;
        height: 100%;
        max-height: 80vh;
      }

      .episodes-sidebar {
        width: 350px;
        background: var(--secondary);
        border-left: 1px solid var(--gray);
        overflow-y: auto;
        display: none;
      }

      .episodes-sidebar.show {
        display: block;
      }

      .episodes-header {
        padding: 20px;
        border-bottom: 1px solid var(--gray);
      }

      .episodes-list {
        padding: 20px;
      }

      .episode-item {
        background: var(--gray);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: var(--transition);
      }

      .episode-item:hover,
      .episode-item.active {
        background: var(--primary);
      }

      .episode-title {
        font-weight: 600;
        margin-bottom: 5px;
      }

      .episode-description {
        font-size: 0.85rem;
        color: var(--gray-light);
        line-height: 1.4;
      }

      /* Ad Overlay */
      .ad-overlay {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.9);
        border-radius: 10px;
        padding: 15px;
        max-width: 300px;
        border: 2px solid var(--primary);
        backdrop-filter: blur(10px);
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.5s ease;
        z-index: 10001;
      }

      .ad-overlay.show {
        opacity: 1;
        transform: translateX(0);
      }

      .ad-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .ad-label {
        font-size: 0.7rem;
        color: var(--gold);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .ad-timer {
        font-size: 0.7rem;
        color: var(--gray-light);
        background: rgba(255, 255, 255, 0.1);
        padding: 2px 6px;
        border-radius: 10px;
      }

      .ad-content {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .ad-media {
        width: 100%;
        height: 120px;
        border-radius: 6px;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.05);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .ad-media img,
      .ad-media video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .ad-text {
        font-size: 0.9rem;
        color: var(--light);
        font-weight: 600;
        text-align: center;
        line-height: 1.3;
      }

      .ad-action {
        background: var(--gradient);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        font-size: 0.85rem;
        text-decoration: none;
        text-align: center;
        display: block;
      }

      .ad-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 3px 10px rgba(229, 9, 20, 0.3);
      }

      /* Responsive Design */
      @media (max-width: 1024px) {
        .search-container {
          width: 300px;
        }

        .movies-grid {
          grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
          gap: 15px;
        }

        .episodes-sidebar {
          width: 300px;
        }
      }

      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.show {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .header {
          padding: 15px 20px;
        }

        .search-container {
          width: 250px;
        }

        .content {
          padding: 20px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .movies-grid {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 12px;
        }

        .episodes-sidebar {
          width: 100%;
          position: absolute;
          top: 0;
          right: 0;
          height: 100%;
          z-index: 1000;
        }

        .player-header {
          padding: 15px 20px;
        }

        .player-title {
          font-size: 1.2rem;
        }
      }

      @media (max-width: 480px) {
        .header-right {
          gap: 8px;
        }

        .balance-display {
          padding: 6px 12px;
          font-size: 0.8rem;
        }

        .search-container {
          width: 200px;
        }

        .section-title {
          font-size: 1.4rem;
        }

        .movies-grid {
          grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
          gap: 10px;
        }

        .movie-poster {
          height: 200px;
        }

        .ad-overlay {
          max-width: 250px;
          padding: 12px;
        }
      }

      /* Loading States */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 40px;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--gray);
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      /* Success/Error Messages */
      .message {
        padding: 12px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-weight: 600;
        text-align: center;
      }

      .message.success {
        background: rgba(0, 212, 170, 0.2);
        border: 1px solid var(--green);
        color: var(--green);
      }

      .message.error {
        background: rgba(229, 9, 20, 0.2);
        border: 1px solid var(--primary);
        color: var(--primary);
      }

      /* Genre Filter */
      .genre-filter {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .genre-btn {
        background: var(--gray);
        color: var(--light);
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.85rem;
        font-weight: 600;
      }

      .genre-btn:hover,
      .genre-btn.active {
        background: var(--primary);
      }

      /* Stats Cards */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: var(--secondary);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        border: 1px solid var(--gray);
        transition: var(--transition);
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      }

      .stat-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        color: var(--primary);
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
        color: var(--light);
      }

      .stat-label {
        color: var(--gray-light);
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <!-- Preloader -->
    <div class="preloader">
      <div class="loader"></div>
    </div>

    <div class="app-container">
      <!-- Sidebar -->
      <nav class="sidebar" id="sidebar">
        <div class="logo">
          <h1>MovieHatch</h1>
        </div>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="#" class="nav-link active" data-section="home">
              <i class="fas fa-home"></i>
              <span>Home</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="movies">
              <i class="fas fa-film"></i>
              <span>Movies</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="series">
              <i class="fas fa-tv"></i>
              <span>TV Shows</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="animation">
              <i class="fas fa-magic"></i>
              <span>Animation</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="upload">
              <i class="fas fa-upload"></i>
              <span>Upload Content</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="my-content">
              <i class="fas fa-video"></i>
              <span>My Content</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Main Content -->
      <main class="main-content" id="mainContent">
        <!-- Header -->
        <header class="header">
          <div class="header-left">
            <button class="menu-toggle" id="menuToggle">
              <i class="fas fa-bars"></i>
            </button>
            <div class="search-container">
              <i class="fas fa-search search-icon"></i>
              <input
                type="text"
                class="search-input"
                id="searchInput"
                placeholder="Search movies, TV shows..."
              />
              <div class="search-results" id="searchResults"></div>
            </div>
          </div>
          <div class="header-right">
            <div class="balance-display" onclick="redirectToWallet()">
              <i class="fas fa-wallet"></i>
              <span>$<span id="userBalance">0.00</span></span>
            </div>
            <button
              class="header-btn"
              onclick="redirectToAds()"
              title="Advertise"
            >
              <i class="fas fa-bullhorn"></i>
            </button>
            <button
              class="header-btn"
              onclick="redirectToSettings()"
              title="Settings"
            >
              <i class="fas fa-cog"></i>
            </button>
            <div class="user-profile" onclick="toggleUserMenu()">
              <div class="user-avatar" id="userAvatar">U</div>
              <span id="userName">User</span>
            </div>
          </div>
        </header>

        <!-- Content -->
        <div class="content">
          <!-- Home Section -->
          <div id="homeSection" class="content-section active">
            <!-- Stats -->
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-film"></i>
                </div>
                <div class="stat-value" id="totalMovies">0</div>
                <div class="stat-label">Total Movies</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-eye"></i>
                </div>
                <div class="stat-value" id="totalViews">0</div>
                <div class="stat-label">Total Views</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-download"></i>
                </div>
                <div class="stat-value" id="totalDownloads">0</div>
                <div class="stat-label">Downloads</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-star"></i>
                </div>
                <div class="stat-value" id="featuredMovies">0</div>
                <div class="stat-label">Featured</div>
              </div>
            </div>

            <!-- Trending Now -->
            <div class="section">
              <div class="section-header">
                <h2 class="section-title">
                  <i class="fas fa-fire"></i>
                  Trending Now
                </h2>
                <a href="#" class="view-more">More ></a>
              </div>
              <div class="movies-grid" id="trendingMovies">
                <!-- Trending movies will be loaded here -->
              </div>
            </div>

            <!-- Action Movies -->
            <div class="section">
              <div class="section-header">
                <h2 class="section-title">
                  <i class="fas fa-fist-raised"></i>
                  Action Movies
                </h2>
                <a href="#" class="view-more">More ></a>
              </div>
              <div class="movies-grid" id="actionMovies">
                <!-- Action movies will be loaded here -->
              </div>
            </div>

            <!-- Comedy Movies -->
            <div class="section">
              <div class="section-header">
                <h2 class="section-title">
                  <i class="fas fa-laugh"></i>
                  Comedy Movies
                </h2>
                <a href="#" class="view-more">More ></a>
              </div>
              <div class="movies-grid" id="comedyMovies">
                <!-- Comedy movies will be loaded here -->
              </div>
            </div>

            <!-- Drama Movies -->
            <div class="section">
              <div class="section-header">
                <h2 class="section-title">
                  <i class="fas fa-theater-masks"></i>
                  Drama Movies
                </h2>
                <a href="#" class="view-more">More ></a>
              </div>
              <div class="movies-grid" id="dramaMovies">
                <!-- Drama movies will be loaded here -->
              </div>
            </div>

            <!-- Horror Movies -->
            <div class="section">
              <div class="section-header">
                <h2 class="section-title">
                  <i class="fas fa-ghost"></i>
                  Horror Movies
                </h2>
                <a href="#" class="view-more">More ></a>
              </div>
              <div class="movies-grid" id="horrorMovies">
                <!-- Horror movies will be loaded here -->
              </div>
            </div>

            <!-- Sci-Fi Movies -->
            <div class="section">
              <div class="section-header">
                <h2 class="section-title">
                  <i class="fas fa-rocket"></i>
                  Sci-Fi Movies
                </h2>
                <a href="#" class="view-more">More ></a>
              </div>
              <div class="movies-grid" id="scifiMovies">
                <!-- Sci-Fi movies will be loaded here -->
              </div>
            </div>
          </div>

          <!-- Movies Section -->
          <div id="moviesSection" class="content-section">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-film"></i>
                All Movies
              </h2>
            </div>
            <div class="genre-filter">
              <button class="genre-btn active" data-genre="all">All</button>
              <button class="genre-btn" data-genre="action">Action</button>
              <button class="genre-btn" data-genre="comedy">Comedy</button>
              <button class="genre-btn" data-genre="drama">Drama</button>
              <button class="genre-btn" data-genre="horror">Horror</button>
              <button class="genre-btn" data-genre="romance">Romance</button>
              <button class="genre-btn" data-genre="sci-fi">Sci-Fi</button>
              <button class="genre-btn" data-genre="thriller">Thriller</button>
              <button class="genre-btn" data-genre="documentary">
                Documentary
              </button>
            </div>
            <div class="movies-grid" id="allMovies">
              <!-- All movies will be loaded here -->
            </div>
          </div>

          <!-- TV Shows Section -->
          <div id="seriesSection" class="content-section">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-tv"></i>
                TV Shows & Series
              </h2>
            </div>
            <div class="movies-grid" id="tvShows">
              <!-- TV shows will be loaded here -->
            </div>
          </div>

          <!-- Animation Section -->
          <div id="animationSection" class="content-section">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-magic"></i>
                Animation
              </h2>
            </div>
            <div class="movies-grid" id="animationMovies">
              <!-- Animation movies will be loaded here -->
            </div>
          </div>

          <!-- Upload Section -->
          <div id="uploadSection" class="content-section">
            <div class="upload-section">
              <div class="section-header">
                <h2 class="section-title">
                  <i class="fas fa-upload"></i>
                  Upload New Content
                </h2>
              </div>

              <form class="upload-form" id="uploadForm">
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input
                      type="text"
                      class="form-input"
                      id="movieTitle"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Video URL *</label>
                    <input
                      type="url"
                      class="form-input"
                      id="videoUrl"
                      required
                    />
                  </div>
                </div>

                <div class="form-group full-width">
                  <label class="form-label">Description *</label>
                  <textarea
                    class="form-textarea"
                    id="movieDescription"
                    required
                  ></textarea>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Poster Image URL</label>
                    <input type="url" class="form-input" id="posterUrl" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Genre</label>
                    <select class="form-select" id="movieGenre">
                      <option value="">Select Genre</option>
                      <option value="action">Action</option>
                      <option value="comedy">Comedy</option>
                      <option value="drama">Drama</option>
                      <option value="horror">Horror</option>
                      <option value="romance">Romance</option>
                      <option value="sci-fi">Sci-Fi</option>
                      <option value="thriller">Thriller</option>
                      <option value="documentary">Documentary</option>
                      <option value="animation">Animation</option>
                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Content Type</label>
                    <select
                      class="form-select"
                      id="contentType"
                      onchange="toggleEpisodeSection()"
                    >
                      <option value="movie">Movie</option>
                      <option value="series">TV Series</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Release Year</label>
                    <input
                      type="number"
                      class="form-input"
                      id="releaseYear"
                      min="1900"
                      max="2030"
                    />
                  </div>
                </div>

                <div
                  class="episode-section"
                  id="episodeSection"
                  style="display: none"
                >
                  <div class="section-header">
                    <h3>Episodes</h3>
                    <button
                      type="button"
                      class="upload-btn"
                      style="width: auto; padding: 8px 16px"
                      onclick="addEpisode()"
                    >
                      <i class="fas fa-plus"></i> Add Episode
                    </button>
                  </div>
                  <div id="episodesList"></div>
                </div>

                <button type="submit" class="upload-btn">
                  <i class="fas fa-upload"></i> Upload Content
                </button>
              </form>
            </div>
          </div>

          <!-- My Content Section -->
          <div id="myContentSection" class="content-section">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-video"></i>
                My Content
              </h2>
            </div>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-video"></i>
                </div>
                <div class="stat-value" id="myMovies">0</div>
                <div class="stat-label">My Movies</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-eye"></i>
                </div>
                <div class="stat-value" id="myViews">0</div>
                <div class="stat-label">Total Views</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stat-value">
                  $<span id="totalEarnings">0.00</span>
                </div>
                <div class="stat-label">Total Earnings</div>
              </div>
            </div>
            <div class="movies-grid" id="myMoviesGrid">
              <!-- Creator's movies will be loaded here -->
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Movie Player Modal -->
    <div class="movie-player-modal" id="moviePlayerModal">
      <div class="player-container">
        <div class="player-header">
          <h2 class="player-title" id="playerTitle">Movie Title</h2>
          <button class="close-player" onclick="closeMoviePlayer()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="player-content">
          <div class="video-section">
            <video class="video-player" id="videoPlayer" controls>
              Your browser does not support the video tag.
            </video>

            <!-- Ad Overlay -->
            <div class="ad-overlay" id="adOverlay">
              <div class="ad-header">
                <span class="ad-label">Advertisement</span>
                <span class="ad-timer" id="adTimer">5s</span>
              </div>
              <div class="ad-content" id="adContent">
                <!-- Ad content will be loaded here -->
              </div>
            </div>
          </div>

          <!-- Episodes Sidebar -->
          <div class="episodes-sidebar" id="episodesSidebar">
            <div class="episodes-header">
              <h3>Episodes</h3>
            </div>
            <div class="episodes-list" id="episodesList">
              <!-- Episodes will be loaded here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDJP2XIR51qGTLINiKvEoscYTMt11CaZ5s",
        authDomain: "paytrust-71e30.firebaseapp.com",
        databaseURL: "https://paytrust-71e30-default-rtdb.firebaseio.com/",
        projectId: "paytrust-71e30",
        storageBucket: "paytrust-71e30.appspot.com",
        messagingSenderId: "492609516838",
        appId: "1:492609516838:android:5a924ad3b7e8e508fa3de7",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const database = firebase.database();

      // Global variables
      let currentUser = null;
      let allMovies = [];
      let currentAds = [];
      let episodeCount = 0;
      let currentMovie = null;
      let adInterval = null;
      let videoWatchTime = 0;
      let lastAdTime = 0;

      // Ad configuration
      const AD_INTERVAL = 20 * 60 * 1000; // 20 minutes
      const AD_DISPLAY_DURATION = 5000; // 5 seconds

      // Initialize app
      document.addEventListener("DOMContentLoaded", function () {
        // Hide preloader
        setTimeout(() => {
          document.querySelector(".preloader").classList.add("fade-out");
          setTimeout(() => {
            document.querySelector(".preloader").style.display = "none";
          }, 500);
        }, 1000);

        // Check authentication
        auth.onAuthStateChanged((user) => {
          if (user) {
            currentUser = user;
            initializeUserData();
            loadMovies();
            loadActiveAds();
            setupEventListeners();
          } else {
            window.location.href = "login.html";
          }
        });
      });

      // Initialize user data
      function initializeUserData() {
        database
          .ref("users/" + currentUser.uid)
          .once("value")
          .then((snapshot) => {
            const userData = snapshot.val();
            if (userData) {
              document.getElementById("userName").textContent =
                userData.name || "User";
              document.getElementById("userAvatar").textContent = (
                userData.name || "User"
              )
                .charAt(0)
                .toUpperCase();
              document.getElementById("userBalance").textContent = (
                userData.balance || 0
              ).toFixed(2);
            }
          });
      }

      // Setup event listeners
      function setupEventListeners() {
        // Menu toggle
        document
          .getElementById("menuToggle")
          .addEventListener("click", function () {
            const sidebar = document.getElementById("sidebar");
            const mainContent = document.getElementById("mainContent");

            sidebar.classList.toggle("hidden");
            if (sidebar.classList.contains("hidden")) {
              mainContent.classList.add("expanded");
            } else {
              mainContent.classList.remove("expanded");
            }
          });

        // Navigation
        document.querySelectorAll(".nav-link").forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();
            const section = this.dataset.section;
            switchSection(section);

            // Update active nav
            document
              .querySelectorAll(".nav-link")
              .forEach((l) => l.classList.remove("active"));
            this.classList.add("active");
          });
        });

        // Search functionality
        const searchInput = document.getElementById("searchInput");
        const searchResults = document.getElementById("searchResults");

        searchInput.addEventListener("input", function () {
          const query = this.value.toLowerCase().trim();
          if (query.length > 0) {
            const filteredMovies = allMovies.filter(
              (movie) =>
                movie.title.toLowerCase().includes(query) ||
                movie.description.toLowerCase().includes(query) ||
                (movie.genre && movie.genre.toLowerCase().includes(query))
            );
            displaySearchResults(filteredMovies);
            searchResults.style.display = "block";
          } else {
            searchResults.style.display = "none";
          }
        });

        // Close search results when clicking outside
        document.addEventListener("click", function (e) {
          if (
            !searchInput.contains(e.target) &&
            !searchResults.contains(e.target)
          ) {
            searchResults.style.display = "none";
          }
        });

        // Genre filter
        document.querySelectorAll(".genre-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            document
              .querySelectorAll(".genre-btn")
              .forEach((b) => b.classList.remove("active"));
            this.classList.add("active");

            const genre = this.dataset.genre;
            filterMoviesByGenre(genre);
          });
        });

        // Upload form
        document
          .getElementById("uploadForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            uploadMovie();
          });

        // Close player on escape
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            closeMoviePlayer();
          }
        });
      }

      // Switch sections
      function switchSection(section) {
        // Hide all sections
        document.querySelectorAll(".content-section").forEach((s) => {
          s.classList.remove("active");
          s.style.display = "none";
        });

        // Show selected section
        const targetSection = document.getElementById(section + "Section");
        if (targetSection) {
          targetSection.style.display = "block";
          targetSection.classList.add("active");
        }

        // Load section-specific content
        switch (section) {
          case "home":
            loadHomeContent();
            break;
          case "movies":
            loadAllMovies();
            break;
          case "series":
            loadTVShows();
            break;
          case "animation":
            loadAnimationMovies();
            break;
          case "my-content":
            loadMyMovies();
            break;
        }
      }

      // Load movies from Firebase
      function loadMovies() {
        database
          .ref("movies")
          .orderByChild("uploadDate")
          .once("value")
          .then((snapshot) => {
            allMovies = [];
            snapshot.forEach((childSnapshot) => {
              const movie = childSnapshot.val();
              movie.id = childSnapshot.key;
              allMovies.push(movie);
            });

            allMovies.reverse(); // Show newest first
            loadHomeContent();
            updateStats();
          });
      }

      // Load home content
      function loadHomeContent() {
        loadTrendingMovies();
        loadMoviesByGenre("action", "actionMovies");
        loadMoviesByGenre("comedy", "comedyMovies");
        loadMoviesByGenre("drama", "dramaMovies");
        loadMoviesByGenre("horror", "horrorMovies");
        loadMoviesByGenre("sci-fi", "scifiMovies");
      }

      // Load trending movies (most viewed)
      function loadTrendingMovies() {
        const trendingMovies = [...allMovies]
          .sort((a, b) => (b.views || 0) - (a.views || 0))
          .slice(0, 6);

        displayMovies(trendingMovies, "trendingMovies");
      }

      // Load movies by genre
      function loadMoviesByGenre(genre, containerId) {
        const genreMovies = allMovies
          .filter((movie) => movie.genre === genre)
          .slice(0, 6);

        displayMovies(genreMovies, containerId);
      }

      // Load all movies
      function loadAllMovies() {
        displayMovies(allMovies, "allMovies");
      }

      // Load TV shows
      function loadTVShows() {
        const tvShows = allMovies.filter(
          (movie) => movie.isSeries || movie.contentType === "series"
        );
        displayMovies(tvShows, "tvShows");
      }

      // Load animation movies
      function loadAnimationMovies() {
        const animationMovies = allMovies.filter(
          (movie) => movie.genre === "animation"
        );
        displayMovies(animationMovies, "animationMovies");
      }

      // Load my movies
      function loadMyMovies() {
        const myMovies = allMovies.filter(
          (movie) => movie.creatorId === currentUser.uid
        );
        displayMovies(myMovies, "myMoviesGrid");
        updateCreatorStats();
      }

      // Display movies in grid
      function displayMovies(movies, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;

        if (movies.length === 0) {
          container.innerHTML = '<div class="loading">No movies found</div>';
          return;
        }

        container.innerHTML = "";
        movies.forEach((movie) => {
          const movieCard = createMovieCard(movie);
          container.appendChild(movieCard);
        });
      }

      // Create movie card
      function createMovieCard(movie) {
        const card = document.createElement("div");
        card.className = "movie-card";
        card.onclick = () => openMoviePlayer(movie);

        const rating = (Math.random() * 3 + 6).toFixed(1); // Random rating between 6.0-9.0

        card.innerHTML = `
                <div class="movie-poster">
                    ${
                      movie.posterUrl &&
                      movie.posterUrl !==
                        "https://via.placeholder.com/300x400?text=Movie+Poster"
                        ? `<img src="${movie.posterUrl}" alt="${movie.title}" onerror="this.style.display='none';">`
                        : `<i class="fas fa-film"></i>`
                    }
                    <div class="movie-rating">${rating}</div>
                    <div class="play-overlay">
                        <button class="play-btn">
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                </div>
                <div class="movie-info">
                    <h3 class="movie-title">${movie.title}</h3>
                    <div class="movie-meta">
                        <span class="movie-genre">${
                          movie.genre || "Movie"
                        }</span>
                        <span>${
                          movie.releaseYear || new Date().getFullYear()
                        }</span>
                    </div>
                    <p class="movie-description">${movie.description}</p>
                </div>
            `;

        return card;
      }

      // Open movie player
      function openMoviePlayer(movie) {
        currentMovie = movie;

        // Increment view count
        database.ref("movies/" + movie.id).transaction((movieData) => {
          if (movieData) {
            movieData.views = (movieData.views || 0) + 1;

            // Track views per user
            if (!movieData.viewsPerUser) movieData.viewsPerUser = {};
            movieData.viewsPerUser[currentUser.uid] =
              (movieData.viewsPerUser[currentUser.uid] || 0) + 1;

            // Update creator earnings every 100 views
            if (movieData.views % 100 === 0) {
              updateCreatorEarnings(movieData.creatorId, 0.0066);
            }
          }
          return movieData;
        });

        // Setup player
        const modal = document.getElementById("moviePlayerModal");
        const player = document.getElementById("videoPlayer");
        const title = document.getElementById("playerTitle");
        const episodesSidebar = document.getElementById("episodesSidebar");

        title.textContent = movie.title;
        player.src = movie.videoUrl;
        modal.classList.add("active");
        document.body.style.overflow = "hidden";

        // Setup episodes if it's a series
        if (movie.episodes && movie.episodes.length > 0) {
          setupEpisodes(movie.episodes);
          episodesSidebar.classList.add("show");
        } else {
          episodesSidebar.classList.remove("show");
        }

        // Reset watch time and setup ads
        videoWatchTime = 0;
        lastAdTime = 0;
        setupAdIntervals();

        // Track video time
        player.addEventListener("timeupdate", function () {
          videoWatchTime = this.currentTime * 1000;

          // Show ad every 20 minutes
          if (videoWatchTime - lastAdTime >= AD_INTERVAL) {
            displayAdOverlay();
            lastAdTime = videoWatchTime;
          }
        });

        // Show initial ad after 5 seconds
        setTimeout(() => {
          if (modal.classList.contains("active")) {
            displayAdOverlay();
          }
        }, 5000);
      }

      // Setup episodes
      function setupEpisodes(episodes) {
        const episodesList = document.getElementById("episodesList");
        episodesList.innerHTML = "";

        episodes.forEach((episode, index) => {
          const episodeItem = document.createElement("div");
          episodeItem.className = "episode-item";
          episodeItem.onclick = () => playEpisode(episode.url, episode.title);

          episodeItem.innerHTML = `
                    <div class="episode-title">Episode ${
                      episode.episodeNumber
                    }: ${episode.title}</div>
                    <div class="episode-description">${
                      episode.description || ""
                    }</div>
                `;

          episodesList.appendChild(episodeItem);
        });
      }

      // Play episode
      function playEpisode(episodeUrl, episodeTitle) {
        const player = document.getElementById("videoPlayer");
        const title = document.getElementById("playerTitle");

        player.src = episodeUrl;
        title.textContent = `${currentMovie.title} - ${episodeTitle}`;

        // Update active episode
        document
          .querySelectorAll(".episode-item")
          .forEach((item) => item.classList.remove("active"));
        event.target.closest(".episode-item").classList.add("active");
      }

      // Close movie player
      function closeMoviePlayer() {
        const modal = document.getElementById("moviePlayerModal");
        const player = document.getElementById("videoPlayer");

        player.pause();
        player.src = "";
        modal.classList.remove("active");
        document.body.style.overflow = "auto";

        // Clear ad intervals
        if (adInterval) {
          clearInterval(adInterval);
        }

        // Hide ad overlay
        const adOverlay = document.getElementById("adOverlay");
        adOverlay.classList.remove("show");

        currentMovie = null;
      }

      // Load active ads
      function loadActiveAds() {
        database
          .ref("activeAds")
          .once("value")
          .then((snapshot) => {
            currentAds = [];
            snapshot.forEach((childSnapshot) => {
              const ad = childSnapshot.val();
              const now = Date.now();

              if (ad.endTime > now) {
                currentAds.push({
                  id: childSnapshot.key,
                  ...ad,
                });

                // Increment impressions
                database
                  .ref(`activeAds/${childSnapshot.key}/impressions`)
                  .transaction((impressions) => {
                    return (impressions || 0) + 1;
                  });
              }
            });
          });
      }

      // Get random ad
      function getRandomAd() {
        if (currentAds.length === 0) return null;
        return currentAds[Math.floor(Math.random() * currentAds.length)];
      }

      // Display ad overlay
      function displayAdOverlay() {
        const ad = getRandomAd();
        if (!ad) return;

        const adOverlay = document.getElementById("adOverlay");
        const adContent = document.getElementById("adContent");
        const adTimer = document.getElementById("adTimer");

        adContent.innerHTML = `
                <div class="ad-media">
                    ${
                      ad.type === "image"
                        ? `<img src="${ad.mediaUrl}" alt="Ad" onerror="this.style.display='none';">`
                        : `<video src="${ad.mediaUrl}" muted autoplay loop onerror="this.style.display='none';"></video>`
                    }
                </div>
                <div class="ad-text">${ad.text}</div>
                <a href="${
                  ad.actionLink
                }" target="_blank" class="ad-action" onclick="trackAdClick('${
          ad.id
        }')">${ad.actionText}</a>
            `;

        adOverlay.classList.add("show");

        // Countdown timer
        let timeLeft = 5;
        adTimer.textContent = timeLeft + "s";

        const countdown = setInterval(() => {
          timeLeft--;
          adTimer.textContent = timeLeft + "s";

          if (timeLeft <= 0) {
            clearInterval(countdown);
            adOverlay.classList.remove("show");
          }
        }, 1000);
      }

      // Setup ad intervals
      function setupAdIntervals() {
        if (adInterval) clearInterval(adInterval);

        adInterval = setInterval(() => {
          const modal = document.getElementById("moviePlayerModal");
          if (modal.classList.contains("active")) {
            displayAdOverlay();
          }
        }, 10 * 60 * 1000); // Every 10 minutes
      }

      // Track ad clicks
      function trackAdClick(adId) {
        database.ref(`activeAds/${adId}/clicks`).transaction((clicks) => {
          return (clicks || 0) + 1;
        });
      }

      // Display search results
      function displaySearchResults(movies) {
        const searchResults = document.getElementById("searchResults");
        searchResults.innerHTML = "";

        movies.slice(0, 5).forEach((movie) => {
          const resultItem = document.createElement("div");
          resultItem.className = "search-result-item";
          resultItem.onclick = () => {
            openMoviePlayer(movie);
            searchResults.style.display = "none";
            document.getElementById("searchInput").value = "";
          };

          resultItem.innerHTML = `
                    <div style="font-weight: 600;">${movie.title}</div>
                    <div style="font-size: 0.8rem; color: var(--gray-light);">${
                      movie.genre || "Movie"
                    } • ${movie.releaseYear || "N/A"}</div>
                `;

          searchResults.appendChild(resultItem);
        });

        if (movies.length === 0) {
          searchResults.innerHTML =
            '<div class="search-result-item">No results found</div>';
        }
      }

      // Filter movies by genre
      function filterMoviesByGenre(genre) {
        const filteredMovies =
          genre === "all"
            ? allMovies
            : allMovies.filter((movie) => movie.genre === genre);
        displayMovies(filteredMovies, "allMovies");
      }

      // Toggle episode section
      function toggleEpisodeSection() {
        const contentType = document.getElementById("contentType").value;
        const episodeSection = document.getElementById("episodeSection");
        episodeSection.style.display =
          contentType === "series" ? "block" : "none";
      }

      // Add episode
      function addEpisode() {
        episodeCount++;
        const episodesList = document.getElementById("episodesList");
        const episodeDiv = document.createElement("div");
        episodeDiv.className = "episode-item";
        episodeDiv.style.background = "var(--gray)";
        episodeDiv.style.marginBottom = "15px";
        episodeDiv.style.padding = "15px";
        episodeDiv.style.borderRadius = "8px";

        episodeDiv.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Episode ${episodeCount} Title</label>
                        <input type="text" class="form-input episode-title" placeholder="Episode title">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Episode ${episodeCount} URL</label>
                        <input type="url" class="form-input episode-url" placeholder="Episode video URL">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Episode ${episodeCount} Description</label>
                    <textarea class="form-textarea episode-description" placeholder="Episode description"></textarea>
                </div>
                <button type="button" onclick="removeEpisode(this)" style="background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-top: 10px;">
                    <i class="fas fa-trash"></i> Remove Episode
                </button>
            `;
        episodesList.appendChild(episodeDiv);
      }

      // Remove episode
      function removeEpisode(button) {
        button.parentElement.remove();
      }

      // Upload movie
      function uploadMovie() {
        const title = document.getElementById("movieTitle").value;
        const videoUrl = document.getElementById("videoUrl").value;
        const description = document.getElementById("movieDescription").value;
        const posterUrl = document.getElementById("posterUrl").value;
        const genre = document.getElementById("movieGenre").value;
        const contentType = document.getElementById("contentType").value;
        const releaseYear = document.getElementById("releaseYear").value;

        // Collect episodes if it's a series
        let episodes = [];
        if (contentType === "series") {
          const episodeItems = document.querySelectorAll(".episode-item");
          episodeItems.forEach((item, index) => {
            const episodeTitle = item.querySelector(".episode-title")?.value;
            const episodeUrl = item.querySelector(".episode-url")?.value;
            const episodeDescription = item.querySelector(
              ".episode-description"
            )?.value;

            if (episodeTitle && episodeUrl) {
              episodes.push({
                title: episodeTitle,
                url: episodeUrl,
                description: episodeDescription,
                episodeNumber: index + 1,
              });
            }
          });
        }

        const movieData = {
          title,
          videoUrl,
          description,
          posterUrl:
            posterUrl ||
            "https://via.placeholder.com/300x400?text=Movie+Poster",
          genre,
          contentType,
          isSeries: contentType === "series",
          releaseYear: releaseYear || new Date().getFullYear(),
          episodes: episodes,
          creatorId: currentUser.uid,
          creatorName: document.getElementById("userName").textContent,
          uploadDate: firebase.database.ServerValue.TIMESTAMP,
          views: 0,
          downloads: 0,
          viewsPerUser: {},
        };

        // Upload to Firebase
        const movieRef = database.ref("movies").push();
        movieRef
          .set(movieData)
          .then(() => {
            showMessage("Content uploaded successfully!", "success");
            document.getElementById("uploadForm").reset();
            document.getElementById("episodeSection").style.display = "none";
            document.getElementById("episodesList").innerHTML = "";
            episodeCount = 0;
            loadMovies();
          })
          .catch((error) => {
            showMessage("Error uploading content: " + error.message, "error");
          });
      }

      // Update creator earnings
      function updateCreatorEarnings(creatorId, amount) {
        database
          .ref("users/" + creatorId + "/balance")
          .transaction((balance) => {
            return (balance || 0) + amount;
          });
      }

      // Update stats
      function updateStats() {
        let totalViews = 0;
        let totalDownloads = 0;
        let featuredCount = 0;

        allMovies.forEach((movie) => {
          totalViews += movie.views || 0;
          totalDownloads += movie.downloads || 0;
          if ((movie.views || 0) > 1000) featuredCount++;
        });

        document.getElementById("totalMovies").textContent = allMovies.length;
        document.getElementById("totalViews").textContent = totalViews;
        document.getElementById("totalDownloads").textContent = totalDownloads;
        document.getElementById("featuredMovies").textContent = featuredCount;
      }

      // Update creator stats
      function updateCreatorStats() {
        const myMovies = allMovies.filter(
          (movie) => movie.creatorId === currentUser.uid
        );
        let myViews = 0;
        let totalEarnings = 0;

        myMovies.forEach((movie) => {
          myViews += movie.views || 0;
          totalEarnings += ((movie.views || 0) * 0.0066) / 100;
        });

        document.getElementById("myMovies").textContent = myMovies.length;
        document.getElementById("myViews").textContent = myViews;
        document.getElementById("totalEarnings").textContent =
          totalEarnings.toFixed(4);
      }

      // Show message
      function showMessage(text, type) {
        const message = document.createElement("div");
        message.className = `message ${type}`;
        message.textContent = text;

        const content = document.querySelector(".content");
        content.insertBefore(message, content.firstChild);

        setTimeout(() => {
          message.remove();
        }, 5000);
      }

      // Navigation functions
      function redirectToWallet() {
        window.location.href = "wallet.html";
      }

      function redirectToAds() {
        window.location.href = "ads.html";
      }

      function redirectToSettings() {
        window.location.href = "settings.html";
      }

      function toggleUserMenu() {
        // Add user menu functionality here
        console.log("User menu clicked");
      }

      // Responsive sidebar for mobile
      if (window.innerWidth <= 768) {
        document.getElementById("sidebar").classList.add("hidden");
        document.getElementById("mainContent").classList.add("expanded");
      }

      // Refresh ads periodically
      setInterval(() => {
        loadActiveAds();
      }, 5 * 60 * 1000); // Every 5 minutes

      // Cleanup on page unload
      window.addEventListener("beforeunload", function () {
        if (adInterval) {
          clearInterval(adInterval);
        }
      });

      // Initialize with home section
      setTimeout(() => {
        switchSection("home");
      }, 100);
    </script>
  </body>
</html>
